# æ€§èƒ½å›å½’è‡ªåŠ¨æ£€æµ‹æŒ‡å—

> **ç‰ˆæœ¬**: 1.0.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-23

---

## æ¦‚è¿°

QCurl æä¾›äº†å®Œæ•´çš„æ€§èƒ½å›å½’è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

1. **GitHub Actions å·¥ä½œæµ** - åœ¨ PR å’Œä¸»åˆ†æ”¯æ¨é€æ—¶è‡ªåŠ¨è¿è¡Œ
2. **æœ¬åœ°æ£€æµ‹è„šæœ¬** - å¼€å‘è€…åœ¨æäº¤å‰è¿è¡Œ
3. **ç»“æœè§£æå·¥å…·** - å°† Qt Test è¾“å‡ºè½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®
4. **æ¯”è¾ƒæŠ¥å‘Šç”Ÿæˆ** - ç”Ÿæˆè¯¦ç»†çš„ Markdown æŠ¥å‘Š

---

## å¿«é€Ÿå¼€å§‹

### æœ¬åœ°è¿è¡Œæ€§èƒ½å›å½’æ£€æµ‹

```bash
# ä¸ master åˆ†æ”¯æ¯”è¾ƒï¼ˆé»˜è®¤ï¼‰
./scripts/run_benchmark_regression.sh

# ä¸æŒ‡å®šåˆ†æ”¯æ¯”è¾ƒ
./scripts/run_benchmark_regression.sh develop

# æŒ‡å®šè¿­ä»£æ¬¡æ•°ï¼ˆæ›´ç²¾ç¡®ä½†æ›´æ…¢ï¼‰
./scripts/run_benchmark_regression.sh master 500

# æŒ‡å®šå›å½’é˜ˆå€¼ï¼ˆç™¾åˆ†æ¯”ï¼‰
./scripts/run_benchmark_regression.sh master 100 15
```

### å•ç‹¬è¿è¡ŒåŸºå‡†æµ‹è¯•

```bash
# ç¼–è¯‘åŸºå‡†æµ‹è¯•
cmake -B build -DBUILD_BENCHMARKS=ON
cmake --build build --parallel

# è¿è¡Œå•ä¸ªåŸºå‡†æµ‹è¯•
./build/benchmarks/benchmark_http2 -iterations 100

# è¿è¡Œæ‰€æœ‰åŸºå‡†æµ‹è¯•
for bench in build/benchmarks/benchmark_*; do
    $bench -iterations 100
done
```

---

## GitHub Actions é›†æˆ

### è§¦å‘æ¡ä»¶

å·¥ä½œæµåœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨è¿è¡Œï¼š

| è§¦å‘æ¡ä»¶ | åˆ†æ”¯ | è¯´æ˜ |
|---------|------|------|
| `push` | master, main, develop | ä¸»åˆ†æ”¯æ¨é€æ—¶æ›´æ–°åŸºçº¿ |
| `pull_request` | master, main, develop | PR æ—¶æ£€æµ‹å›å½’å¹¶è¯„è®º |
| `workflow_dispatch` | ä»»æ„ | æ‰‹åŠ¨è§¦å‘ï¼Œå¯æŒ‡å®šè¿­ä»£æ¬¡æ•° |

### æ–‡ä»¶å˜æ›´è¿‡æ»¤

åªæœ‰ä»¥ä¸‹è·¯å¾„å˜æ›´æ—¶æ‰ä¼šè§¦å‘ï¼š

- `src/**` - æºä»£ç 
- `benchmarks/**` - åŸºå‡†æµ‹è¯•ä»£ç 
- `.github/workflows/benchmark.yml` - å·¥ä½œæµé…ç½®

### PR è¯„è®º

å½“ PR è§¦å‘å·¥ä½œæµæ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ PR ä¸­æ·»åŠ æ€§èƒ½æ¯”è¾ƒæŠ¥å‘Šè¯„è®ºï¼š

```markdown
## ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœ

### ğŸ“ˆ æ€§èƒ½æ¯”è¾ƒæ¦‚è§ˆ
| é¡¹ç›® | åŸºçº¿ | å½“å‰ |
|------|------|------|
| ç‰ˆæœ¬ | `abc1234` | `def5678` |

### ğŸ“Š ç»Ÿè®¡æ‘˜è¦
- âœ… æ”¹è¿›: **2** ä¸ªæµ‹è¯•
- âŒ å›å½’: **0** ä¸ªæµ‹è¯•
- â– æ— å˜åŒ–: **15** ä¸ªæµ‹è¯•
```

### å›å½’æ£€æµ‹

å¦‚æœæ£€æµ‹åˆ°è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤ 10%ï¼‰çš„æ€§èƒ½å›å½’ï¼š

1. å·¥ä½œæµå°†**å¤±è´¥**
2. PR å°†è¢«æ ‡è®°ä¸ºæ£€æŸ¥å¤±è´¥
3. è¯„è®ºä¸­ä¼šåˆ—å‡ºå…·ä½“çš„å›å½’æµ‹è¯•

---

## å·¥å…·è¯¦è§£

### parse_benchmark_results.py

å°† Qt Test QBENCHMARK è¾“å‡ºè§£æä¸º JSONï¼š

```bash
python3 scripts/parse_benchmark_results.py \
    benchmark-results/ \
    --output summary.json \
    --verbose
```

**è¾“å…¥æ ¼å¼**ï¼ˆQt Test è¾“å‡ºï¼‰:

```
RESULT : BenchmarkHttp2::benchmarkHttp1Request():
     123.45 msecs per iteration (total: 12345, iterations: 100)
```

**è¾“å‡ºæ ¼å¼**ï¼ˆJSONï¼‰:

```json
{
  "metadata": {
    "timestamp": "2025-11-23T12:00:00Z",
    "version": "abc1234"
  },
  "benchmarks": {
    "benchmark_http2": {
      "benchmarkHttp1Request": {
        "value": 123.45,
        "unit": "msecs",
        "class": "BenchmarkHttp2"
      }
    }
  }
}
```

### compare_benchmarks.py

æ¯”è¾ƒä¸¤æ¬¡åŸºå‡†æµ‹è¯•ç»“æœï¼š

```bash
python3 scripts/compare_benchmarks.py \
    baseline.json \
    current.json \
    --threshold 10 \
    --output comparison.md
```

**å‚æ•°è¯´æ˜**:

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--threshold` | å›å½’æ£€æµ‹é˜ˆå€¼ï¼ˆç™¾åˆ†æ¯”ï¼‰ | 10 |
| `--output` | è¾“å‡ºæŠ¥å‘Šè·¯å¾„ | stdout |
| `--fail-on-regression` | æ£€æµ‹åˆ°å›å½’æ—¶è¿”å›éé›¶é€€å‡ºç  | true |

**é€€å‡ºç **:

| é€€å‡ºç  | å«ä¹‰ |
|--------|------|
| 0 | æ— å›å½’ |
| 1 | æ£€æµ‹åˆ°å›å½’ |

---

## é…ç½®è¯´æ˜

### é˜ˆå€¼è°ƒæ•´

å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è°ƒæ•´å›å½’æ£€æµ‹é˜ˆå€¼ï¼š

1. **GitHub Actions**: ä¿®æ”¹ `.github/workflows/benchmark.yml` ä¸­çš„ `--threshold` å‚æ•°
2. **æœ¬åœ°è„šæœ¬**: ä¼ é€’ç¬¬ä¸‰ä¸ªå‚æ•° `./scripts/run_benchmark_regression.sh master 100 15`

**å»ºè®®é˜ˆå€¼**:

| åœºæ™¯ | é˜ˆå€¼ | è¯´æ˜ |
|------|------|------|
| æ—¥å¸¸å¼€å‘ | 10% | å¹³è¡¡çµæ•åº¦å’Œè¯¯æŠ¥ |
| å‘å¸ƒå‰ | 5% | æ›´ä¸¥æ ¼çš„æ£€æµ‹ |
| å®éªŒæ€§åŠŸèƒ½ | 20% | å…è®¸æ›´å¤§æ³¢åŠ¨ |

### è¿­ä»£æ¬¡æ•°

è¿­ä»£æ¬¡æ•°å½±å“ç»“æœçš„ç²¾ç¡®åº¦ï¼š

| è¿­ä»£æ¬¡æ•° | ç²¾ç¡®åº¦ | è¿è¡Œæ—¶é—´ |
|---------|--------|---------|
| 100 | ä¸­ç­‰ | ~5 åˆ†é’Ÿ |
| 500 | è¾ƒé«˜ | ~15 åˆ†é’Ÿ |
| 1000 | é«˜ | ~30 åˆ†é’Ÿ |

**å»ºè®®**:
- CI/CD: 100-200 æ¬¡ï¼ˆå¿«é€Ÿåé¦ˆï¼‰
- å‘å¸ƒå‰: 500-1000 æ¬¡ï¼ˆç²¾ç¡®ç»“æœï¼‰

---

## æœ€ä½³å®è·µ

### 1. æäº¤å‰è¿è¡Œ

åœ¨æäº¤æ€§èƒ½æ•æ„Ÿçš„ä»£ç å‰ï¼Œå…ˆè¿è¡Œæœ¬åœ°æ£€æµ‹ï¼š

```bash
./scripts/run_benchmark_regression.sh
```

### 2. ç¨³å®šçš„æµ‹è¯•ç¯å¢ƒ

ä¸ºè·å¾—ä¸€è‡´çš„ç»“æœï¼š

```bash
# å…³é—­å…¶ä»–ç¨‹åº
killall chrome firefox

# å›ºå®š CPU é¢‘ç‡ï¼ˆLinuxï¼‰
sudo cpupower frequency-set -g performance

# å¤šæ¬¡è¿è¡Œå–å¹³å‡
for i in {1..3}; do
    ./scripts/run_benchmark_regression.sh
done
```

### 3. å…³æ³¨è¶‹åŠ¿

å•æ¬¡å›å½’å¯èƒ½æ˜¯å™ªå£°ï¼Œå…³æ³¨å¤šæ¬¡æµ‹è¯•çš„è¶‹åŠ¿ï¼š

- æŸ¥çœ‹ GitHub Actions å†å²è®°å½•
- æ¯”è¾ƒå¤šä¸ªæäº¤çš„ç»“æœ
- ä½¿ç”¨è¾ƒé«˜çš„è¿­ä»£æ¬¡æ•°ç¡®è®¤

### 4. åˆç†è®¾ç½®é˜ˆå€¼

æ ¹æ®æµ‹è¯•çš„ç¨³å®šæ€§è®¾ç½®é˜ˆå€¼ï¼š

- **ç½‘ç»œæµ‹è¯•**: 15-20%ï¼ˆç½‘ç»œå»¶è¿Ÿæ³¢åŠ¨å¤§ï¼‰
- **CPU å¯†é›†å‹**: 5-10%ï¼ˆç›¸å¯¹ç¨³å®šï¼‰
- **å†…å­˜æµ‹è¯•**: 10-15%ï¼ˆå—ç³»ç»Ÿå½±å“ï¼‰

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šåŸºå‡†æµ‹è¯•è¶…æ—¶

**åŸå› **: æµ‹è¯•æœåŠ¡å™¨æœªå¯åŠ¨æˆ–ç½‘ç»œé—®é¢˜

**è§£å†³**:
```bash
# å¯åŠ¨ httpbin
docker run -d -p 8935:80 kennethreitz/httpbin

# æ£€æŸ¥è¿æ¥
curl http://localhost:8935/get
```

### é—®é¢˜ï¼šç»“æœæ³¢åŠ¨å¤§

**åŸå› **: ç³»ç»Ÿè´Ÿè½½ä¸ç¨³å®šæˆ–è¿­ä»£æ¬¡æ•°å¤ªå°‘

**è§£å†³**:
```bash
# å¢åŠ è¿­ä»£æ¬¡æ•°
./scripts/run_benchmark_regression.sh master 500

# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
htop
```

### é—®é¢˜ï¼šGitHub Actions å¤±è´¥

**åŸå› **: ä¾èµ–å®‰è£…å¤±è´¥æˆ–æµ‹è¯•æœåŠ¡ä¸å¯ç”¨

**è§£å†³**:
1. æ£€æŸ¥ Actions æ—¥å¿—
2. ç¡®è®¤ `httpbin` æœåŠ¡å¯åŠ¨æˆåŠŸ
3. æ£€æŸ¥ Qt6 å’Œ libcurl å®‰è£…

---

## æ–‡ä»¶æ¸…å•

```
.github/
â””â”€â”€ workflows/
    â””â”€â”€ benchmark.yml           # GitHub Actions å·¥ä½œæµ

scripts/
â”œâ”€â”€ parse_benchmark_results.py  # è§£æ Qt Test è¾“å‡º
â”œâ”€â”€ compare_benchmarks.py       # æ¯”è¾ƒåŸºå‡†æµ‹è¯•ç»“æœ
â””â”€â”€ run_benchmark_regression.sh # æœ¬åœ°è¿è¡Œè„šæœ¬

docs/
â””â”€â”€ PERFORMANCE_REGRESSION_GUIDE.md  # æœ¬æ–‡æ¡£
```

---

## å‚è€ƒ

- [Qt Test QBENCHMARK](https://doc.qt.io/qt-6/qtest.html#QBENCHMARK)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [æ€§èƒ½æµ‹è¯•æœ€ä½³å®è·µ](https://www.brendangregg.com/methodology.html)

---

**æ–‡æ¡£ç»´æŠ¤è€…**: AI (Claude)
**æœ€åæ›´æ–°**: 2025-11-23
